---
title: "Sliders"
engine: knitr
theme: sandstone
format: 
  live-html:
    page-layout: custom
execute:
  echo: false
---

{{< include ./_extensions/r-wasm/live/_knitr.qmd >}}

```{r, load}
#| include: false
library(shiny)
library(bslib)
library(ggplot2)
library(ggtext)
library(shinythemes)
library(thematic)
library(tidyverse)
library(httr)
library(htmltools)
library(glue)
```

```{ojs}
//| echo: false
//| panel: sidebar

import {vl} from "@vega/vega-lite-api"
import {aq, op} from "@uwdata/arquero"

vg = require('vega-lite')

viewof wetted = Inputs.range(
  [0, 10], 
  {value: 5, step: 0.1, label: "Wetted width ():"}
);
viewof substrate = Inputs.range(
  [0, 10], 
  {value: 5, step: 0.1, label: "Substrate size ():"}
);
viewof percent = Inputs.range(
  [0, 20], 
  {value: 10, step: 0.1, label: "Percent lake ():"}
);
```

```{ojs}
//| echo: false
//| panel: fill
//| layout: [ [1], [1,1] ]
function myFunction(wetted, substrate, percent) {
  return aq.table({
  'wetted': [wetted, wetted, wetted, wetted],
  'substrate': [substrate, substrate, substrate, substrate],
  'percent': [percent, percent, percent, percent],
  'response_type': ["Invertebrate biomass ()", "Periphyton biomass ()", "Invertebrate diversity", "Par length (cm)"],
  'response_predict': [0.83-0.095*wetted+0.03*substrate, 0.44+0.026*wetted+0.32*percent, 0.7+0.0016*substrate, 0.1+0.06*wetted],
  'image_path': ["https://github.com/emmwilson/exploits_watershed/blob/1e2a6e53708bb3b2821020c2342e07fee41eebc2/data/invert.png","https://github.com/emmwilson/exploits_watershed/blob/1e2a6e53708bb3b2821020c2342e07fee41eebc2/data/embed.png","https://github.com/emmwilson/exploits_watershed/blob/1e2a6e53708bb3b2821020c2342e07fee41eebc2/data/invert_div.png","https://github.com/emmwilson/exploits_watershed/blob/1e2a6e53708bb3b2821020c2342e07fee41eebc2/data/par_len.png"]
})
}

predictions_ps = myFunction(wetted, substrate, percent)


weatherColors = ["darkgray", "steelblue", "paleturquoise", "gold"]

vl
  .data(predictions_ps)
  .layer(
    vl.markBar()
      .encode(
        vl.x().fieldN('response_type')
              .axis({title: "Response Types", labels: false}), 
        vl.y().fieldQ('response_predict')
              .axis({ title: null, grid: false })
              .scale({domain: [0, 8]}),
        vl.color({legend: null}).fieldN("response_type")
                  .scale({ range: weatherColors })
        ),
    vl.markText({ align: "center", dy: -7, fontSize: 18})
      .encode(
        vl.x().fieldN("response_type")
              .axis({title: "Response Types", labels: false}), 
        vl.y().fieldQ("response_predict")
              .axis({ title: null, grid: false })
              .scale({domain: [0, 8]}),
        vl.text().fieldQ("response_predict")
        ),
    vl.markImage()
      .encode(
        vl.x().fieldN("response_type")
              .axis({title: "Response Types", labels: false}), 
        vl.y().fieldQ("response_predict")
              .axis({ title: null, grid: false })
              .scale({domain: [0, 8]}),
        vl.url().fieldN("image_path")
        )
      )
  .width(Math.floor(width-0.3*width))
  .height(Math.floor(0.4 * width))
  .autosize('fit')
  .render()
```
