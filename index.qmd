---
title: "Salmon resource predictions"
theme: sandstone
format:
  html:
    grid:
      sidebar-width: 10px
      margin-width: 10px
      body-width: 1900px
date: last-modified
date-format: "DD/MM/YY"
---

:::: {.columns}

::: {.column width="35%"}
Project description paragraph..... 


Use the map to explore predictions for watersheds across Newfoundland. You can also use the top navigation bar to explore predictions under the Watersheds tab, and to investigate the relationships between input variable and predicted values on our Sliders page. 


Affiliated manuscript:  
Authors:  
Affiliations:  
Funding:  
App development: Emmerson Wilson
:::

::: {.column width="2%"}
<!-- empty column to create gap -->
:::


```{r, library}
#| include: false

pacman::p_load(shiny,
               bslib,
               ggplot2,
               ggtext,
               shinythemes,
               thematic,
               tidyverse,
               httr,
               leaflet,
               leafem,
               terra,
               htmltools,
               glue,
               cowplot,
               igraph )

```

```{r, import}
#| include: false
# import layers
  ## river extent
  exploits_watersheds <- vect("data/spatial data/exploits_watershed.shp") |>  
    project("EPSG:4326 - WGS 84")
  
exploits_watersheds[["html"]] <- "Exploits_map.html"
exploits_watersheds[["ws"]] <- "Exploits River Watershed"
  
  rocky_watershed <- vect("data/spatial data/rocky_watershed.shp") |> 
    project("EPSG:4326 - WGS 84")
  
rocky_watershed[["html"]] <- "Rocky_map.html" # eventually wtaersheds will come from same file which will already have html links
rocky_watershed[["ws"]] <- "Rocky River Watershed"

  TN_watershed <- vect("data/spatial data/Terranova_basin.shp") |>  
    project("EPSG:4326 - WGS 84")
  
TN_watershed[["html"]] <- "TerraNova_map.html" # eventually wtaersheds will come from same file which will already have html links
TN_watershed[["ws"]] <- "Terra Nova River Watershed"


watersheds <- rbind(exploits_watersheds, rocky_watershed, TN_watershed)

  
  # import arrow
arrow <- "https://cdn.pixabay.com/photo/2013/07/12/17/54/arrow-152596_960_720.png"
```


```{r, palettes}
#| include: false
 #colour palettes for predictions
  # invert.pal <- colorNumeric(c("#f47c3c", "#d9534f"), domain = predictions_reaches$invert, na.color = "transparent")
  # embed.pal <- colorNumeric(c("#e9c602", "#93c54b"), domain =  predictions_reaches$embed, na.color = "transparent")
library(sf)
neighbors <- st_touches(st_as_sf(watersheds), st_as_sf(watersheds))
graph <- graph_from_adj_list(neighbors)

colors <- greedy_vertex_coloring(graph)
watersheds$color_id <- as.factor(colors)

pal <- colorFactor(palette = c("#caf0f8", "#90e0ef",  "#1f78b4", "#031D5E"), domain = watersheds$color_id)

```
  

```{r, popup_labels}
#| include: false
# adds information to popups for each reach wehn it is selected

  label_text <- glue('<a href={watersheds$html}><b>{watersheds$ws}</b></a>')|> 
 
  lapply(htmltools::HTML) 
  
```

::: {.column width="63%"}

```{r, map}
#| echo: false
#| warning: false
  
NL_map <- leaflet(width = 1900, height = 2150) |> 
      addProviderTiles('Esri.WorldImagery') |> # adds base map

      # open map to this screen
      setView(-56.65499, 49.15, zoom = 7) |> 
  
      #can recenter to that location by clicking button
      addHomeButton(ext = c(-60,48, -52, 50), position = "topleft", group = "Recenter") |> 
      # create layers to add vectors to
      addMapPane("drainage", zIndex = 410) |> 
      
      # add polygons and lines
      ## exploits drainage area
      addPolygons(data = watersheds, color = ~pal(color_id), weight = 1.5, fillColor = ~pal(color_id), fillOpacity = 0.3, options = pathOptions(pane = "drainage"), popup = ~label_text, highlightOptions = highlightOptions(
                color =  ~pal(color_id), weight = 1.5, fillOpacity = 0.5,
                bringToFront = TRUE, sendToBack = TRUE))  |>
  
  addScaleBar(position = "bottomright") |> 
  addLogo(arrow)

NL_map
```
